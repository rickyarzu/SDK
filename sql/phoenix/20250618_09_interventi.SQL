SELECT S.chiave, C.descrizione_scheda, C.AMMINISTRATORE, 
       S.CLIENTE, F.NOME, F.PROVINCIA, F.CAP, F.INDIRIZZO, F.TELEFONO, F.NOTE, F.ORARIO_APERTURA_DAL1, F.ORARIO_APERTURA_DAL2,
       F.ORARIO_APERTURA_AL1, F.ORARIO_APERTURA_AL2, F.CHIUSURA, F.CELLULARE, F.EMAIL, F.ESCLUDI_DA_GENERAZIONE, F.SEDE, F.ID,
       F.REF_TELEFONO, F.REF_CELLULARE, F.COMUNE, S.FATTURA,
       S.DATA_INTERVENTO , S.GENERAZIONE_AUTOMATICA , S.TECNICO_INTERVENTO , S.SCANSIONE , S.REGISTRO , S.NOTE_PER_IL_TECNICO , S.SOSPESO,
       S.DA_ESPORTARE_SUL_WEB , S.RESPONSABILE , S.ESPORTATO_SU_MOBILE , S.NOTE_DAL_TECNICO ,
       S.VERBALE_PROVA_DINAMICA , S.VERBALE_MANICHETTE , S.PREVENTIVO , S.IGNORA_EVIDENZIAZIONE,
       S.ANNULLATO_DA_TABLET , S.MOBILEWARN_NUOVA_ATTREZZATURA , S.MOBILEWARN_ORDINARIA_RITIRATA,
       S.MOBILEWARN_N_ORDIN_CONTROLLATA , S.MOBILEWARN_SMALTIMENTO , S.STATO_LAVORAZIONE , S.DATA_CHIUSURA_DA_SERVER , S.CHIUSURA_EXT,
       S.CHIUSURA_STATINO , S.MOBILEWARN_NON_ESEGUITI , S.PRESA_IN_CARICO , S.FORNITURA,
       V.ordinari, V.straordinari, V.interventi, T.descrizione as NOME_TECNICO, 
       S.APPUNTAMENTO_DATA, S.APPUNTAMENTO_ORA, S.STATO,I.STATINO, 
       COALESCE(I.ESTINTORI_ORDINARIO, 0) ESTINTORI_ORDINARIO,
       COALESCE(I.ESTINTORI_STRAORDINARIO, 0) ESTINTORI_STRAORDINARIO,
       COALESCE(I.GRUPPI_ELETTR, 0) GRUPPI_ELETTR,
       COALESCE(I.FUMI, 0) FUMI,
       COALESCE(I.LUCI, 0) LUCI,
       COALESCE(I.IDRANTI, 0) IDRANTI,
       COALESCE(I.SPRINKLER, 0) SPRINKLER,
       COALESCE(I.IMPIANTI_EL, 0) IMPIANTI_EL, 
       T.EMAIL AS EMAIL_TECNICO,
       S.GCAL, 
       CAST(SUBSTRING(generazione_automatica FROM 5 FOR 2) AS INTEGER) AS mese_calcolato,  -- Estrae il mese
       CAST(SUBSTRING(generazione_automatica FROM 1 FOR 4) AS INTEGER) AS anno_calcolato,  -- Estrae l'anno
       CAST(DATEADD(-1 DAY TO DATEADD(1 MONTH TO CAST(SUBSTRING(generazione_automatica FROM 1 FOR 4) || '-' || SUBSTRING(generazione_automatica FROM 5 FOR 2) || '-01' AS DATE))) AS DATE) AS data_fine_mese_calcolato,  -- Calcola l'ultimo giorno del mese
       DATEDIFF(DAY, CURRENT_DATE, CAST(DATEADD(-1 DAY TO DATEADD(1 MONTH TO CAST(SUBSTRING(generazione_automatica FROM 1 FOR 4) || '-' || SUBSTRING(generazione_automatica FROM 5 FOR 2) || '-01' AS DATE))) AS DATE)) AS ritardo  -- Calcola il ritardo in giorni
FROM FILIALI_CLIENTI F 
JOIN CLIENTI C ON  F.CLIENTE = C.CHIAVE
JOIN STATINI S ON F.chiave = S.filiale
LEFT OUTER JOIN INTERVENTI_STRAORDINARI_VIEW V ON S.chiave = V.statino
JOIN TECNICI T ON T.chiave = S.responsabile
LEFT OUTER JOIN INTERVENTI_STATINI_SINTESI_VIEW I ON S.chiave = I.statino
WHERE S.STATO > -1 AND S.STATO < 9
-- AND GENERAZIONE_AUTOMATICA IS NOT NULL
 AND S.CHIAVE = 2205524
-- AND C. = 'COMMISSARIATI'
ORDER BY F.CAP,C.DESCRIZIONE_SCHEDA,F.SEDE DESC

select s.* from statini s
join filiali_clienti F ON F.chiave = S.filiale
JOIN CLIENTI C ON C.chiave = S.cliente
JOIN TECNICI T ON T.chiave = S.responsabile
WHERE S.chiave = 2205524 AND S.stato > -1
-- AND S.stato < 9


select * from statini s where s.generazione_automatica is null order by chiave desc